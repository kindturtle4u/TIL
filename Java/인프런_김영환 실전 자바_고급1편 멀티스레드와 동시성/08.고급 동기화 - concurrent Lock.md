> 출처 : 인프런 김영한의 실전 자바 - 고급1편 멀티스레드와 동시성 (김영한)

# 08.고급 동기화 - concurrent Lock
## LockSupport1
### synchronized 단점
- **무한 대기**: `BLOCKED` 상태의 스레드는 락이 풀릴 때 까지 무한 대기한다.
  * 특정 시간까지만 대기하는 타임아웃X
  * 중간에 인터럽트X
- **공정성**: 락이 돌아왔을 때 `BLOCKED` 상태의 여러 스레드 중에 어떤 스레드가 락을 획득할 지 알 수 없다. 최악의 경우 특정 스레드가 너무 오랜기간 락을 획득하지 못할 수 있다.
- 이런 문제를 해결하기 위해 자바 1.5부터 `java.util.concurrent` 라는 동시성 문제 해결을 위한 라이브러리 패키 지가 추가된다.

### LockSupport 기능
- `park()` : 스레드를 `WAITING` 상태로 변경한다.
  `parkNanos(nanos)` : 스레드를 나노초 동안만 `TIMED_WAITING` 상태로 변경한다.
- `unpark(thread)` : `WAITING` 상태의 대상 스레드를 `RUNNABLE` 상태로 변경한다.

```java
public class LockSupportMainV1 {

    public static void main(String[] args) {
        Thread thread1 = new Thread(new ParkTest(), "Thread-1");
        thread1.start();

        // 잠시 대기하여 Thread-1이 park 상태에 빠질 시간을 준다.
        sleep(100);

        log("Thead-1 state: " + thread1.getState());

        log("main -> unpark(Thread-1)");
        //LockSupport.unpark(thread1); // 1. unpark 사용
        thread1.interrupt(); // 2. interrupt 사용

    }

    static class ParkTest implements Runnable {

        @Override
        public void run() {
            log("park 시작");
            LockSupport.park();
            log("park 종료, state: " + Thread.currentThread().getState());
            log("인터럽트 상태: " + Thread.currentThread().isInterrupted());
        }
    }
}
```
- unpark 사용
```log
2024-10-17 14:11:43.637 [ Thread-1] park 시작
2024-10-17 14:11:43.710 [     main] Thead-1 state: WAITING
2024-10-17 14:11:43.710 [     main] main -> unpark(Thread-1)
2024-10-17 14:11:43.710 [ Thread-1] park 종료, state: RUNNABLE
2024-10-17 14:11:43.713 [ Thread-1] 인터럽트 상태: false
```
- 인터럽트 사용: `WAITING` 상태의 스레드에 인터럽트가 발생하면 `WAITING` 상태에서 `RUNNABLE` 상태로 변하면서 깨어난다.
```log
2024-10-17 14:07:29.888 [ Thread-1] park 시작
2024-10-17 14:07:29.964 [     main] Thead-1 state: WAITING
2024-10-17 14:07:29.964 [     main] main -> unpark(Thread-1)
2024-10-17 14:07:29.965 [ Thread-1] park 종료, state: RUNNABLE
2024-10-17 14:07:29.967 [ Thread-1] 인터럽트 상태: true
```
## LockSupport2

## ReentrantLock - 이론

## ReentrantLock - 활용

## ReentrantLock - 대기 중단

## 정리
