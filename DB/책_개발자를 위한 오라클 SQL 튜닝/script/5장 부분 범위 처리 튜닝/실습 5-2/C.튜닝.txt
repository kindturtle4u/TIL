CREATE INDEX
TB_STOCK_TRD_IDX01
ON TB_STOCK_TRD(STOCK_CD, TRD_DTM DESC);

ANALYZE INDEX TB_STOCK_TRD_IDX01 COMPUTE STATISTICS;

SELECT * FROM
(
SELECT
ROWNUM RNUM, TRD_DTM, TRD_CNT, TRD_AMT,
COUNT(*) OVER() CNT
FROM
(
	SELECT
	TRD_DTM, TRD_CNT, TRD_AMT
	FROM TB_STOCK_TRD
	WHERE STOCK_CD = '000001'
	AND TRD_DTM >= TO_CHAR(SYSDATE-365, 'YYYYMMDDHH24MISS')
  ORDER BY TRD_DTM
)
WHERE ROWNUM <= 30
)
WHERE RNUM >= 21

