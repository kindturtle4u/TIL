CREATE TABLE TB_CUST
(
    CUST_ID VARCHAR2(10), --고객ID
    CUST_NM VARCHAR2(50) --고객명
);

CREATE TABLE TB_CUST_DTL
(
    CUST_ID VARCHAR2(10), -- 고객ID
    SEQ    NUMBER(3), --시퀀스
    CUST_INFO VARCHAR2(150) --고객정보
);

CREATE TABLE TB_ORD
(
    ORD_NO VARCHAR2(10), --주문번호
    ORD_DT VARCHAR2(8), --주문일자
    CUST_ID VARCHAR2(10) --고객ID
);


INSERT INTO TB_CUST
SELECT
    LPAD(TO_CHAR(ROWNUM), 10, '0'),
    DBMS_RANDOM.STRING('U', 50)
FROM DUAL CONNECT BY LEVEL <= 100000;

COMMIT;

INSERT INTO TB_CUST_DTL
SELECT
CUST_ID,
ROW_NUMBER() OVER (PARTITION BY CUST_ID ORDER BY CUST_ID),
DBMS_RANDOM.STRING('U', 50)
FROM TB_CUST, ( SELECT LEVEL LV FROM DUAL CONNECT BY LEVEL <= 10);

COMMIT;

ALTER TABLE TB_ORD NOLOGGING;

INSERT /*+ APPEND */ INTO TB_ORD --APPEND 힌트 사용
SELECT
LPAD(TO_CHAR(ROWNUM), 10, '0'),
TO_CHAR(SYSDATE - TRUNC(DBMS_RANDOM.VALUE(1, 3650)), 'YYYYMMDD'),
CUST_ID
FROM TB_CUST, ( SELECT LEVEL LV FROM DUAL CONNECT BY LEVEL <= 50);

COMMIT;

ALTER TABLE TB_CUST
ADD CONSTRAINT TB_CUST_PK
PRIMARY KEY (CUST_ID);

ALTER TABLE TB_CUST_DTL
ADD CONSTRAINT TB_CUST_DTL_PK
PRIMARY KEY (CUST_ID, SEQ);

ALTER TABLE TB_ORD
ADD CONSTRAINT TB_ORD_PK
PRIMARY KEY (ORD_NO);

CREATE INDEX TB_ORD_IDX01 ON TB_ORD(CUST_ID);

ANALYZE TABLE TB_CUST COMPUTE STATISTICS
FOR TABLE FOR ALL INDEXES FOR ALL INDEXED COLUMNS SIZE 254;

ANALYZE TABLE TB_CUST_DTL COMPUTE STATISTICS
FOR TABLE FOR ALL INDEXES FOR ALL INDEXED COLUMNS SIZE 254;

ANALYZE TABLE TB_ORD COMPUTE STATISTICS
FOR TABLE FOR ALL INDEXES FOR ALL INDEXED COLUMNS SIZE 254;



