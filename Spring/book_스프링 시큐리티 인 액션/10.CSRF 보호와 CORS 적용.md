> 출처 : 스프링 시큐리티 인 액션 : 보안 기초부터 OAuth 2까지, 스프링 시큐리티를 활용한 안전한 앱 설계와 구현

# 10.CSRF 보호와 CORS 적용
## 10.1 애플리케이션에 CSRF(사이트 간 요청 위조)보호 적용
- HTTP POST 로 직접 엔드포인트를 호출할 수 없는 이유는 스프링 시큐리티에 기본적으로 활성화되는 CSRF 보호 때문이다.

### 10.1.1 스프링 시큐리티의 CSRF 보호가 작동하는 방식
- CSRF 공격은 사용자가 웹 애플리케이션에 로그인했다고 가정하며 사용자는 공격자에게 속아서 작업중인 같은 애플리케이션에 작업을 실행하는 스크립트가 포함된 페이지를 연다.
위조 코드는 이제 사용자를 가장하고 사용자 대신 작업을 수행할 수 있다.
- CSRF 보호는 어떻게 작동할까? 한 가지 확실한 것은 데이터를 변경하려는 작업을 수행하려면 먼저 사용자가 적어도 한 번은 HTTP GET으로 웹 페이지를 요청해야 한다는 것이다.
이때 애플리케이션은 고유한 토큰을 생성한다. 이제 부터 애플리케이션은 헤더에 이 고유한 값이 들어있는 요청에 대해서면 변경 작업(POST, PUT, DELETE 등)을 수행한다.
- 애플리케이션은 토큰 값을 안다는 것은 다른 시스템이 아닌 애플리케이션 자체가 변경 요청을 보낸 증거라고 본다.
- CSRF 보호의 시작점은 필터 체인의 CsrfFilter라는 한 필터다. CsrfFilter는 요청을 가로채고 GET, HEAD, TRACE, OPTIONS를 포함하는 HTTP 방식의 요청을 모두 허용하고 다른 모든
요청에는 토큰이 포함된 헤더가 있는지 확인한다.
- CsrfFilter는 CsrfTokenRepository 구성 요소를 이용해 새 토큰 생성, 토큰 저장, 토큰 검증에 필요한 CSRF 토큰 값을 관리한다. 기본적으로 CsrfTokenRepository는 토큰을 HTTP 세션에
저장하고 랜덤 UUID(Random Universally Unique Identifier)로 토큰을 생성한다.

### 10.1.2 실제 시나리오에서 CSRF 보호 사용
- 
