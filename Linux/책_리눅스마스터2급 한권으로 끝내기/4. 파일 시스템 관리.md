> 출처 :  리눅스마스터 2급 한권으로 끝내기 읽으면서 정리 

# 4. 파일 시스템 관리
## 4.1 사용자 권한 및 그룹 설정
### 4.1.1 파일 및 디렉터리의 속성
- 모든 파일과 디렉터리에는 허가권(permission)과 소유권(ownership)이 부여 된다.
- 구조 `- rw-r--r-- 1 root root 45 10월 11 13:44 linux.txt`
  * 파일유형
    + `-`: 일반파일
    + `l`: 심볼릭 링크 파일
    + `d`: 장치 파일
    + `p`: 파이프
    + `c`: 문자파일
    + `b`: 블록 장치 파일
    + `s`: 소켓
  * 허가권
  * 링크수
  * 소유자명
  * 그룹명
  * 파일크기
  * 마지막으로 변경된 시간
  * 파일명
  
### 4.1.2 소유권 관련 명령어
#### chown
- 파일이나 디렉터리의 사용자 소유권과 그룹 소유권을 변경하는 명령어이다.
- 파일이나 디렉터리의 사용자 소유권과 그룹 소유권을 한번에 변경할 수 있다.
- 기본형식
  * `chown [옵션] [사용자명] [파일/디렉터리명]`
  * `chown [옵션] [사용자명].[그룹명] [파일/디렉터리명]`

#### chgrp
- 파일이나 디렉터리의 그룹 소유권을 변경하는 명령어이다.
- 기본형식: `chgrp [옵션] [그룹명] [파일/디렉터리명]`

### 4.1.3 허가권 관련 명령어
- 파일이나 디렉터리의 허가권을 변경하는 명령어이다.
- 허가권은 읽기(read), 쓰기(write), 실행으로 구분할 수 있다.
- 설정 모드는 '기호 모드(symbolic mode)' 또는 '숫자 모드(numeric mode)'로 설정한다.
- 사용기호
  * `u`: 소유자
  * `g`: 그룹
  * `o`: 제3자
  * `a`: 모든 사용자
  * `+`: 허가권 부여
  * `-`: 허가권 제거
  * `=`: 허가권 지정
  * `r`: 읽기
  * `w`: 쓰기 
  * `x`: 실행

#### chmod
- 파일이나 디렉터리의 허가권을 변경하는 명령어이.
- 기본형식: `chmod [옵션] [허가권] [파일/디렉터리명]`

#### umask
- 새로 생성되는 파일이나 디렉터리의 기본 허가권을 지정하는 명령이다.
- unmask 값이 022인 경우 Default 파일 권한은 644, 디렉터리 권한은 755로 생성한다.
- 파일: 666 - 022 = 644
- 디렉터리: 777 - 022 = 755

### 4.1.4 특수 허가권
- 프로세스가 실행되는 동안 해당 파일을 실행한 사용자가 아닌 해당 파일을 소유한 사용자의 권한으로 실행하도록 만드는 허가권이다.
#### 기능
- 낮은 수준의 사용자가 높은 수준의 자원에 접근 시 접근 제한으로 인해 발생하는 문제를 해결하기 위해 사용한다.
- 프로세스를 실행하는 동안만 소유자나 그룹 권한으로 실행한다.
- SetUID, SetGID 비트: 소문자 's', 대문자'S', Sticky 비트: 소문자 't', 대문자 'T'
  * 소문자: 해당 파일에 실행권한이 부여되어 있을 경우이며, 정상적인 권한으로 실행함
  * 대문자: 해당 파일에 실행권한이 부여되어 있지 않을 경우이며, 정상적인 권한으로 실행되진 않음

#### 허가권
- SetUID
  * 기호: `s`
  * 절대값: 4000
  * 설명
    + 파일의 소유자 실행 권한에 UID 설정
    + SetUID가 설정된 파일 실행 시, 특정 작업 수행을 위하여 일시적으로 파일 소유자의 권한을 부여하는 비트
- SetGID 
  * 기호: `s`
  * 절대값: 2000
  * 설명
    + 파일의 그룹 실행 권한에 GID 설정
    + SetGID가 설정된 파일 실행 시, 특정 작업 수행을 위하여 일시적으로 파일 소유자 그룹의 권한을 부여하는 비트
- Sticky
  * 기호: `t`
  * 절대값: 1000
  * 설명
    + 파일의 제 3자 실행 권한에 Sticky Bit 설정
    + Sticky Bit가 설정된 디렉터리 안의 파일에 모든 사용자에게 쓰기 권한이 부여되어 있을 경우 파일 소유자나 'root' 사용자가 아니면 해당 파일을 삭제할 수 없음
    + 누구나 파일을 생성, 수정은 가능
  
### 4.1.5 디스크 쿼터(Disk Quota)
- 파일 시스템별 사용자나 그룹의 사용량을 제한할 경우에 사용한다.

#### 기능
- 블록(Block) 단위나 아이노드(I-Node)의 개수를 제핞나다.
- 사용자별, 파일 시스템별로 작동한다.
- 관련파일
```shell
$ cat /etc/fstab
```

#### 사용자별 쿼터 설정
```shell
$ equota -u test
Disk quotas for user test (uid 500) :
    filesystem  blocks  soft    hard    inodes  soft    hard
    /dev/sdb1   0       0       0       0       5       3
``` 
- filesystem
  * blocks: 현재 사용자가 사용한 블록(단위: KB)
    + soft: 사용자가 사용할 수 있는 최대 용량(초과 가능), 유예 기간 동안 초과 경고 메시지
    + hard: 사용자가 사용할 수 있는 최대 용량(초과 불가능)
  * inodes: 현재 사용자가 사용한 파일 수(단위: 개수)
    + soft: 사용자가 사용할 수 있는 최대 파일 수(초과 가능)
    + hard: 사용자가 사용할 수 있는 최대 파일 수(초과 불가능)

#### 쿼터 관련 명령어
##### `quotaon`
- 쿼터를 활성화 하는 명령어이다.
- 기본형식: `quotaon [옵션] [사용자/그룹명]`

##### `quotaoff`
- 파일시스템에 적용된 쿼터의 사용을 중지하는 명령이다.
- 기본형식: `quotaoff [옵션] [사용자/그룹명]`

##### `quotacheck`
- 모든 파일 시스템을 점검하고, 쿼터 설정 및 기록 파일 갱신하는 명령어이다.
- `quota.user`, `quota.group`, `aquota.user`, `aquota.group`의 파일을 점검하고 갱신
- 기본형식: `quotacheck [옵션]`

##### `edquota`
- 사용자와 그룹에 대해 쿼터를 설정하고 변경하는 명령어이다.
- 기본형식: `edquota [옵션] [사용자/그룹명]`

##### `setquota` 
- 터미널에서 직접 사용자나 그룹에 쿼터를 적용하는 명령어이다.
- 기본형식: `setquota [옵션] [사용자/그룹명] [block soft limit] [block hard limit] [inode soft limit] [inode hard limit] [파티션명]`

##### `repquota`
- 터미널에서 직접 사용자나 그룹에 적용된 쿼터(디스크 사용량, 적용 내용)를 요약하여 출력하는 명령어이다.
- 기본형식 `repquota [옵션] [사용자/그룹명/파일 시스템명]` 

##### `xfs_quota`
- xfs 파일 시스템에서 quota를 설정하기 위해 사용하는 명령어이다.
- 사용자 그룹에 용량 제한을 하는 usrquota, grpquota가 있으며, 특정 폴더에 대해 용량 제한을 할 수있는 pquota(project quota)가 있다.
- 전문가 모드와 일반 모드가 있으며, 일반적으로 전문가 모드로 설정하게 된다.
- 사용방법 `xfs_quota [-V][-x][-p prog][-c cmd]...[-d project]...[path]`
- 옵션
  * `-V`: 버전출력
  * `-x`: 전문가 모드
  * `-p`: 프로젝트명 지정
  * `-c`: 설정할 인수 지정
  * `-d`: 프로젝트 이름 또는 숫자 식별자를 지정

```shell
# 사용자 Quota 설정
$ xfs_quota -x -c 'limit -u bsoft=100m bhard=110m isoft=50 ihard=55 user1' /data/disk1

# 그룹 Quota 설정
$ xfs_quota -x -c 'limit -g bsoft=100m bhard=110m isoft 50 ihard=55 group1' /data/disk1

# Quota 설정 확인
$ xfs_quota -x -c 'report -h' /data/disk1
```

## 4.2 파일 시스템 관리 유틸리티
### 4.2.1 파일 시스템 구조
- 파일 시스템은 시스템에서 파일이나 자료를 쉽게 검새갛고, 접근, 유지, 관리하기 위한 조직체계 이다. 즉, 저장매체에는 많은 파일이 있으므로,
이러한 파일을 관리하는 방법을 의미한다.
- 계층적 구조를 가지며, 디스크 파티션별로 하나씩 존재하고, 하드디스크나 CD-ROM과 같은 물리적 저장소를 관리한다.
- 종류
  * ext
  * ext2
  * ext3
  * ext4

#### 기타 파일 시스템
- 저널링 파일 시스템
  * JFS
  * XFS
  * ReiserFS
- 네트워크 파일 시스템
  * SMB
  * CIFS
  * NFS
- 기타 파일 시스템
  * ISO9660
  * UDF
  * HPFS

### 4.2.2 파일 시스테 관련 명령어
#### fdisk
- 파티션을 생성, 수정, 제거 및 파일 시스템의 유형을 지정하는 명령어이다.
- 기본형식: `fdisk [옵션] [장치명]` `mkfs -t ext4 /dev/sda1`

#### mkfs
- 파일시스템을 생성하는 명령이다.
- 기본형식: `mkfs [옵션] [파일 시스템 유형] [장치명]`

#### mke2fs
- mkfs 명령어의 확장 버전으로 파일 시스템을 생성하는 명령어이다.
- 기본형식: `mke2fs [옵션] [파일 시스템 유형] [장치명] [블록 개수]`  `mke2fs -t ext4 /dev/sda1`

#### mkfs.xfs
- xfs 파일 시스템을 생성하는 명령어이다.
- 기본형식: `mkfs.xfs [옵션] [파티션명]` `mkfs.xfs /dev/sdb1`

#### fsck
- 파일 시스템의 무결성 점검과 오류를 복구하는 명령이다.
- lost+found 디렉터리에 저장된 파일을 복구하며, 복구가 완료되면 파일은 제거된다.
- 기본형식: `fsck [옵션] [장치명]`

#### e2fsck
- fsck 명령어의 확장 버전이다.
- 파일 시스템의 무결성 점검과 오류를 복구하는 명령어이다.
- 기본형식: `e2fsck [옵션] [장치명]` `e2fsck -c /dev/sda1`

#### xfs_repair
- xfs 파일 파일 시스템을 검사 및 복구하는 명령어이다.
- 기본형식: `xfs_repair [옵션] [파티션명]` `xfs_repair /dev/sdb1`

#### mount, umount
- 특정 장치와 디렉터리를 연결하는 명령어이다.
- 기본적으로 주변 장치는 자동으로 마운트되지 않으므로, 시스템 부팅 후 수동으로 마운트하여 사용하고, 사용 완료 후에는 언마운트하여 연결을 종료해야 한다.
- 기본형식: `mount [옵션] [장치명] [마운트 포인트]`

#### eject
- DVD나 CD-ROM 등의 미디어 장치를 해제하고, 꺼내는 명령어이다.
- 기본형식: `eject [옵션] [장치명/마운트포인트]` `eject /dev/sr0`

#### df
- 시스템에 마운트된 하드디스크의 사용량과 남은 용량을 확인하는 명령어이다.
- 기본적으로 블록 단위(1,024 바이트)로 출력된다.
- 기본형식: `df [옵션] [파일명]`
- 옵션
  * `-a`: 모든 파일 시스템 출력(0 블록인 파일 시스템 포함)
  * `-B`: 블록 단위로 출력
  * `-h`: 읽기 쉬운 단위로 출력(KB, MB, GB)
  * `-H`: 1KB는 1,024 바이트지만 1,000 단위로 출력
  * `-i`: 'i-Node'의 남은 공간, 사용 공간, 사용 퍼센트를 출력
  * `-k`: KB 단위로 출력
  * `-l`: 로컬 파일 시스템만 출력
  * `-P`: POSIX에서 사용하는 형태로 출력
  * `-t`: 파일 시스템을 지정하여 출력
  * `-T`: 파일 시스템 유형을 출력
  * `-x`: 지정한 파일 시스템을 제외하고, 모든 파일 시스템 정보 출력

### 4.2.3 파일 시스템 관련 파일
#### `/etc/fstab`
- 파일시스템 관련 설정 정보를 저장하고 있는 파일이다.
- 시스템 부팅 시 파일 시스템을 자동으로 마운트 하고자 할 때, 이 파일에 설정하면 된다.
- 구조 `/dev/sdb1(파일시스템 장치명) /home(마운트포인트) ext3(파일시스템 유형) defaults(파일 시스템 속성-사용자쿼터적용) 0(Dump설정 , 0: dump 불가능 , 1: dump 가능) 0(파일 시스템 점검옵션, 0 점검하지 않음, 1 루트 파일 시스템, 2 일반파일 시스템)`
- 
