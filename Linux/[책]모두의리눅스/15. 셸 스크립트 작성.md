> 출처 :  모두의 리눅스 읽으면서 정리 

# 15. 셸 스크립트 작성 
## 15.1 셸 스크립트란
- 셸에서 실행될 커맨드 라인을 입력해 놓은 파일을 셸 스크립트라 합니다. 단순히 명령어를 나열하기도 하지만 조건 분기와 반복과 같은
복잡한 제어구조도 사용할 수 있어 프로그래밍 언어에 가깝습니다. 

## 15.2 셸 선택
### 15.2.1 어떤 셸의 셸 스크립트를 작성할 것인가
- 셸 스크립트는 셸에 의해 해석되기 때문에 어떤 셸을 사용하는지에 따라 문법도 달라집니다. 요즘에는 sh나 bash용 셸 스크립트를 작성하는 것이 보통이므로 둘 중 하나를 선택해야 합니다.
- sh가 아닌 bash기반으로 한 셸스크립트를 소개
  * sh로 셸 스크립트를 작성해도 호환성의 문제는 여전한다.
  * bash에는 셸 스크립트를 위한 풍부한 기능이 포함되어 있다.

## 15.3 셸 스크립트 작성
- 홈 디렉터리의 파일 사용량을 출력 `du -h ~ | tail -n 1` 
- vim으로 셸 스크립트 homesize.sh 작성, 확장자인 sh를 붙이지 않아도 동작하지만 파일 이름만 봐도 셸 스크립트인 것을 알 수 있게 sh라는 확장자를 붙이는 것이 좋습니다.
```shell
#!/bin/bash
du -h ~ | tail -n 1
```
- 셸 스크립트로 실행 권한 부여 `$ chmod +x homsize.sh`
- 셸 스크립트 실행 `$ ./homesize.sh`, 여기서 앞에 `./`를 붙이는 것을 잊지 마세요

## 15.4 셸 스크립트 실행 형식
- 셸 스크립트를 만들 때 파일의 상단에 #!로 시작하는 행이 하나 있었습니다. 이를 셔뱅이라 합니다. 

### 15.4.1 셔뱅
- 리눅스에서 파일을 실행 할 때는 셸에서 파일 이름을 지정하면 됩니다. 셸 스크립트에서는 다음과 같습니다. `./homesize.sh`
- 리눅스 커널은 먼저 파일의 첫 부분을 확인합니다. `#!`가 있으면 그 뒤에 적힌 명령어를 실행합니다.
- 즉, `#!/bin/bash`란 이 셸 스크립트는 `/bin/bash`를 사용한다고 명시적으로 선언한 것입니다. 이것이 셔뱅의 역할입니다.
- 셔뱅이 적힌 셸 스크립트는 실제다 다음과 같이 리눅스 커널이 확장되는 것 입니다.
`$ ./homesize.sh` -> `$/bin/bash ./homesize.sh`
- 셔뱅을 입력하면 셸 스크립트를 실행할 때 `/bin/bash`를 입력하지 않아도 되고, 또한 사용중일 셸이 배시가 아니여도 자동으로 `/bin/bash`가 스크립트를 실행합니다.
- 그리고 셸에서는 `#`으로 시작하는 행을 주석으로 간주합니다. 따라서 셔뱅도 주석으로 간주됩니다.

### 15.4.2 source 명령어: 파일에서 명령어를 읽어서 실행
- 셸스크립트를 실행하는 또 다른 방법으로 source 명령어를 사용하는 것 입니다. 이는 위에서 살펴본 방법과 다소 다릅니다.
- 셔뱅을 사용하지 않은 셸 스크립느 homesize-noshebang.sh 를 준비합니다. `du -h ~ | tail -n 1`
- source 명령어로 셸 스크립트 실행 `$ source ./homesize-noshebang.sh`
- source 명령어는 지정한 파일 안의 커맨드 라인을 마치 셸에서 직접 입력한 것과 동일하게 실행합니다.
- source 명령어를 사용하면 셔뱅으로 지정한 셸이 아니라 언제나 현재 셸이 사용됩니다. 그리고 파일을 직접 실행하는 것이 아니기 대문에 파일에 실행권한을 부여할 필요가 없습니다.
- source 명령어와 동일하게 동작하는 . 명령어가 있습니다. 배시에서는 . 명령어가 source 명령어와 완전히 동일하게 동작합니다. `. ./homesize-noshebang.sh`

### 15.4.3 실행 방법에 의한 차이
- 1.파일 이름만으로 실행 `./homesize.sh`
- 2.셸의 인자로 지정하여 실행 `bash homesize-onshebang.sh`
- 3.source 명령어를 사용하여 실행 `source ./homesize-noshebang.sh`
- 1번의 경우 셔뱅을 기재해야한다는 점만 빼고는 2번과 거의 동일합니다.
- 3번의 경우 다른 방법과 동작상 차이가 있습니다. source 명령어를 사용하면 현재 셸을 기준으로 파일에 기재된 커맨드 라인이 실행됩니다. 따라서 현재 설정된 셸 환경에 영향을 받습니다.
- 파일이름으로 실행한 경우는 서브 셸에서 실행됩니다. 서브셸이란 현재 셸에서 새롭게 실행된 자식 프로세서의 셸을 의미합니다.
- 또한, source 명령어는 현재 셸에 영향을 주기 때문에 주의해야 합니다. 

#### source 명령어 사용 예
- 셔뱅에 지정한 셸에서 실행되기 때문에 현재 사용자가 사용하는 셸에 영향을 받지 않습니다.
- source를 사용하면 현재 셸의 환경에 따라 실행이 안 되기도 하고, 현재 셸의 변숫값이나 별명을 바꿀 수도 있습니다.
- source 명령어가 유용한 경우도 있습니다. 가장 대표적인 예를 배시 설정 파일인 ~/.bashrc에서 볼 수 있습니다.
8장에서 소개한 대로 `~/.profile`에서 다음과 같이 sorce 명령어로 `~/.bashrc` 파일을 호출합니다.
```shell
if [ -f "$HOME/.bashrc" ]; then
    . "$HOME/.bashrc"
fi
```

## 15.5 셸 스크립트 배치
- `./` 를 붙이지 않고 실행한 경우
```shell
$ homesize.sh
homesize.sh: 명령어를 찾을 수 없습니다.
```
- 이는 검색 경로에서 homesize.sh 라는 명령어를 찾을 수 없었다는 의미입니다. 검색 경로는 환경변수 PATH에 설정되어 있어 다음과 같이 echo 명령어로 확인할수 있습니다. `$ echo $PATH`
- 검색 경로에 등록된 디렉터리에 있지 않는 이상 셸 스크립트를 이름만으로 실행할 수 없습니다. 이때는 상대 경로나 절대 경로로 파일 위치를 지정해야 합니다.

### 15.5.1 셸 스크립트 배치용 디렉터리
- `~/bin`이라는 디렉터리를 만들고 셸 스크립트를 해당 디렉터리로 옯긴다.
```shell
mkdir ~/bin
mv homesize.sh ~/bin
```
- `~/.profile` 파일을 열어 다음 내용을 추가합니다. `PATH=$PATH:~/bin`
- 로그아웃 후 로그인 or `source ~/.profile`
- 이름만으로 셸 스크립트 실행 `$ homesize.sh`

### 15.5.2 source 명령어와 패스
- source를 사용할 때 이름만으로 셸 스크립트를 지정하다 보면 의도치 않은 스크립트를 실행할 가능성이 높아집니다. 따라서 상대 경로나 절대 경로를 사용하여 명시적으로
셸 스크립트의 위치를 지정하는 것이 좋습니다.
