> 출처 :  모두의 리눅스 읽으면서 정리 

# 9. 퍼미션과 슈퍼 사용자
## 9.1 파일 소유자와 소유 그룹
- 리눅스의 모든 파일에는 소유자가 있습니다. 직접 작성한 메모부터 시스템에서 제공하는 라이브러리 명령어에 이르기까지 모든 파일에는 소유자가 있습니다.
파일의 소유자는 해당 파일에 대한 접근 권한을 자유롭게 설정할 수 있습니다.
- `ls -l` 명령어로 파일의 소유자를 확인할 수있습니다.
  * 세번째 항목: 파일의 소유자
  * 네번째 항목: 파일의 소유 그룹
- 새롭게 파일을 작성하면 그 파일을 작성한 사용자가 파일의 소유자가 됩니다.

### 9.1.1 그룹
- 앞서 등장한 그룹이란 사용자들을 묶은 그룹을 말합니다. 예를 들어 시스템 관리를 수행하는 wheel이라는 그룹을 만든 뒤 여러 사용자를 해당 그룹에 소속 시키면 
좀 더 쉽게 여러 사용자의 권한을 관리할 수 있습니다.
- 한 사용자는 여러 그룹에 소속될 수있습니다. 그리고 어떤 사용자도 최소한 한 그룹에는 소속되어 있습니다. 
- 사용자를 처음 만들 때 특별히 소속될 그룹을 지정하지 않으면 사용자 이름과 동일한 그룹에 소속됩니다. 
- 현재 본인이 어떤 그룹에 소속되어 있는지 확인하려면 groups라는 명령어를 사용하면 됩니다. 

## 9.2 파일의 퍼미션
- 리눅스의 각 파일에는 '누구에게 어떤 권한을 허가할지'에 대한 정보가 설정되어 있습니다. 이를 퍼미션(permission)이라 합니다.
- `-l`옵션으로 표시되는 첫번째 글자는 파일 타입입니다.
  * `-`: 일반파일
  * `d`: 디렉터리
  * `l`: 심볼릭 링크를 의미합니다.

- 퍼미션 기호 및 의미
  * `r`: 읽기 (read)
  * `w`: 쓰기 (write)
  * `x`: 실행 (execute)

- 실행권한 x가 없으면 직접 실행 불가능

### 9.2.1 디렉터리의 퍼미션
- 파일과 마찬가지로 디렉터리에도 퍼미션을 설정할 수 있습니다. 디렉터리에 설정된 퍼미션을 확인하기 위해서는 ls명령어를 실행할때 `-l`옵션과 함께
디렉터리의 정보를 표시하는 `-d` 옵션을 지정합니다.
- 디렉터리 퍼미션 기호의 의미
  * `r`: 읽기, 디렉터리에 포함된 파일 리스트 취득가능
  * `w`: 쓰기, 디렉터리 하위에 파일 및 디렉터리 작성 및 삭제 가능
  * `x`: 실행, 디렉터리로 이동 가능
- 디렉터리에 대한 쓰기 권한이 있으면 해당 디렉터리 밑에 파일을 만들거나 지울 수 있습니다. 여기서 파일을 지울 수 있는지
여부가 파일이 아니라 디렉터리의 퍼미션에 의해 결정된다는 점에 주의해야 합니다.
- 다른 사용자가 볼 수 있게 하려면 보통 `rwxr-xr-x`라는 퍼미션을 설정합니다. 그러면 소유자는 모든 권한을 가지게 되며 다른 사용자들은
cd 명령어로 이동하여 파일을 읽을 수 있습니다. 하지만 다른 사용자가 파일을 만들거나 지울 수는 없습니다.
- 그리고 `rwx------`와 같이 퍼미션을 설정하면 다른 사용자가 해당 디렉터리의 내용을 일절 볼 수 없게 됩니다.

### 9.2.2 chmod 명령어: 파일 모드 변경
- 파일이나 디렉터리의 퍼미션을 설정하려면 chmod라는 명령어를 사용해야 합니다. 이때 두가지 방법으로 퍼미션을 설정할 수 있는데,
기호를 사용하는 기호모드와 수치를 사용하는 수치모드 입니다.
- 파일모드의 변경은 해당 파일의 소유자 혹은 슈퍼 사용자만 가능합니다. 누구나 파일 모드를 변경할 수 있다면 애초에 파일에
퍼미션이 있을 이유가 없을 것 입니다.

#### 기호모드
- 기호모드로 퍼미션 변경 `chmod [ugoa] [+-=] [rwx] <파일이름>`
- 기호모드를 사용하면 누구에게 어떤 퍼미션을 부여할지 알기 쉽습니다.
- chmod 명령어의 사용자 지정 기호
  * `u`: 소유자
  * `g`: 소유그룹
  * `o`: 기타사용자
  * `a`: ugo 모두

- chmode 명령어의 연산자
  * `+`: 퍼미션을 추가함
  * `-`: 퍼미션을 금지함
  * `=`: 지정한 퍼미션과 같게

```shell
chmod u+w file.txt #소유자에게 읽기 퍼미션 추가
chmod g-w file.txt #그룹의 읽기 퍼미션 제거
chmod go=r file.txt #소유그룹과 그 외 사용자들에 대한 펴미션 변경 
```

#### 수치모드
- 수치모드로 퍼미션 변경 `chmod <8진수의 수치> <파일 이름>`
- 기호모드가 상대적으로 퍼미션을 지정하는 반면 수치 모드는 기존 퍼미션을 새로운 퍼미션으로 덮어쓰게 됩니다.
- 수치모드에서는 퍼미션에 해당하는 숫자를 지정합니다. rwx 각 문자에 해당하는 숫자를 더해서 퍼미션을 지정합니다.
- 수치모드에서의 퍼미션 추가
  * 읽기 (r): 4
  * 쓰기 (w): 2
  * 실행 (x): 1
- 예를들어 `rwxr-xr-x`라는 권한은 다음과 같이 755라는 숫자가 됩니다.

## 9.3 슈퍼사용자
- 리눅스에는 관리자 권한을 가지는 특별한 사용자인 슈퍼 사용자가 있습니다. 슈퍼 사용자는 root라는 사용자 이름을 가져서
루트 사용자라고도 부릅니다. 반대로 슈퍼 사용자가 아닌 사용자를 일반 사용자라고 부릅니다.
- 슈퍼 사용자는 강력한 권한을 가지고 있어 시스템 설정 파일을 바꾸거나 새로운 애플리케이션을 설치할 수 있습니다.
그리고 파일에 설정된 퍼미션을 무시하고 모든 파일을 읽고 수정할 수 있습니다.
- 이는 다른 말로 슈퍼 사용자라면 위험한 명령어도 제한없이 실행할 수 있을을 의미합니다. 일반 사용자라면 실수로 중요한 시스템
파일을 지우는 것이 애초에 불가능 하지만, 슈퍼 사용자라면 가능합니다. 따라서 평소에는 일반 사용자로 조작하다가 반드시 필요한
상황에서만 슈퍼 사용자로 조작하는 것이 좋습니다.

### 9.3.1 su 명령어: 사용자 전환
- `su` 명령어를 사용하면 일시적으로 다른 사용자로 전환할 수 있습니다. 즉 로그아웃하지 않고 다른 사용자가 될 수 있습니다.
- `su` 명령어로 다른 사용자로 전환할 수도 있지만 주로 슈퍼 사용자로 전환하기 위해 사용합니다. 보통 보안상의 이유로 슈퍼 사용자로
직접 로그인 할 수 없도록 설정하는 경우가 많습니다. 즉, 먼저 일반 사용자로 로그인한 뒤에 su 명령어로 슈퍼 사용자로 전환하는 방식으로
작업하게 됩니다.

- 슈퍼 사용자의 암호 설정
```shell
[ec2-user@ip-172-31-34-202] ~ 01:19:59 $ sudo passwd root
root 사용자의 비밀 번호 변경 중
새  암호:
새  암호 재입력:
passwd: 모든 인증 토큰이 성공적으로 업데이트 되었습니다.
```
- 일반사용자 로그인 -> `su` 명령어 실행 -> 슈퍼사용자로 변경 -> 슈퍼사용자로 작업 -> exit -> 일반사용자로 돌아감
- `su`를 통해 슈퍼 사용자가 되었을 때 환경 변수나 현재 디렉터리는 일반 사용자의 상태가 유지된다는 점입니다.
슈퍼 사용자의 환경으로 초기화 하고 싶으면 다음과 같이 하이픈(-)을 추가해서 실행해야 합니다. `su -`
- 일부 사용자 환경을 유지한 채 슈퍼 사용자로 작업하다 보면 일부 애플리케이션이 정상적으로 동작하지 않을 수 있습니다.
따라서 슈퍼 사용자로 전환할 때는 하이픈(-)을 붙여서 실행하는 것이 좋습니다.

### 9.3.2 sudo 명령어: 명령어를 다른 사용자가 되어 실행
- sudo 명령어를 사용하면 다른사용자가 되어 명령어를 실행할 수 있습니다. 사용자를 지정하지 않으면 슈퍼사용자로 명령어를 실행합니다.
주로 일반 사용자로 로그인한 뒤 슈퍼 사용자로만 실행할 수 있는 명령어를 실행하기 위해 사용합니다.
- sudo는 한 명령어만 슈퍼 사용자로 실행하기 위한 명령어입니다. 따라서 지정한 명령어가 끝나면 일반 사용자로 돌아옵니다.
반면 `su` 명령어로 슈퍼 사용자로 전환하면 exit를 하기 전까지는 슈퍼 사용자인 채로 있게 됩니다.
- 리눅스에서는 어떤 사용자가 sudo 명령어를 사용할 수 있는지 설정할 수 있습니다. sudo 명령어를 사용할 수 있는 사용자의 목록은
/etc/sudoers라는 파일을 통해 관리됩니다.
- sudoers 파일의 각항목은 `<사용자><머신이름>=(<권한>)<명령어>`와 같은 형식을 따릅니다. `<사용자>`에는 일반 사용자 이름
혹은 `%<그룹 이름>`을 지정합니다.
- 일반적으로 설치 직후 다음과 같이 설정되어 있습니다. `%wheel ALL=(ALL) ALL`
- `visudo` 명령어: sudoers 파일 편집, `/etc/sudoers`파일을 직접 텍스트 에디터로 편집하는 것은 위험합니다. 혹여 오타라도 발생하면
어느 누구도 sudo를 사용할 수 없게 되기 때문입니다. visudo 명령어를 실행하면 텍스트 에디터가 기동하여 `/etc/sudoers` 파일을
편집하게 됩니다. 기본적으로 Vim이 기동하빈다. 내용을 편집한 뒤 종료하면 변경사항이 반영됩니다.
혹시 변경 사항에 문제가 있으면 종료 시 다음과 같이 에러가 표시됩니다.

### 9.3.3 su와 sudo 어느 것을 사용하는 것이 좋을까
- 요즘에는 su보다는 sudo가 많이 사용되는 추세입니다.

#### 터미널 멀티 플렉서
- 터미널 멀티플렉서란 한 단말에서 여러 개의 가상 단말을 다룰 수 있게 해주는 애플리케이션입니다. 여기서는 무척 인기가 많은
tmux라는 멀티플렉서 애플리케이션을 소개합니다.
- tmux를 사용하기 위해서는 yum이나 apt-get으로 tmux 패키지를 설치한 뒤에 셀에서 tmux라고 입력하여 실행하면 됩니다.
- 새로운 셸을 뛰우고 싶을때 `Ctrl + b, c`를 입력합니다. 그러면 tmux가 가상 단말을 만들어 해당 화면으로 전환합니다.
가상 단말을 tmux에서는 창(윈도우)이라고 부릅니다. 여러 창 간의 화면을 전환화면서 작업할 수 있습니다.
- 단축키
  * `Ctrl + b, n`: 다음 창으로 전환
  * `Ctrl + b, p`: 이전 창으로 전환
  * `Ctrl + b, <숫자>`: 지정한 번호의 창으로 전환
  * `Ctrl + b, 1`: 바로 이전에 사용했던 창으로 전환
  * `Ctrl + b, &`: 작성한 창 닫기 (or exit 명령어)
