> 출처 : 한 입 크기로 잘라 먹는 Next.js
 
# 2. 페이지 라우터 버전으로 Nextjs 시작하기
## Next.js 앱 생성하기
- `npx create-next-app@v15.2.3 onbite-books-page-router`
  * `Would you like to use TypeScript?` -> Y
  * `Would you like to use ESLint?` -> Y
  * `Would you like to use Tailwind CSS` -> N
  * `Would you like your code inside a 'src/' directory?` -> Y
  * `Would you like to use App Router?` -> N
  * `Would you like to use Turbopack for 'next dev'` -> N
  * `Would you like to customize the import alias('@/*' by default)` -> N

## 생성한 Next.js 앱 살펴보기
### package.json
- `dev`: Next.js 앱을 개발 모드로 실행합니다.
- `build`: Next.js 앱을 빌드합니다.
- `start`: 빌드한 Next.js 앱을 실행합니다. 프로덕션 모드로 실행한다고도 합니다.
- `lint`: ESLint 규칙을 기반으로 코드의 품질을 정적으로 검사합니다.

### next.config.ts
- 이 파일은 Next.js 앱의 설정을 담당합니다.
```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
  reactStrictMode: true,
};

export default nextConfig;
```
- `nextConfig` Next.js 앱의 설정을 담는 장소 입니다.
- `reactStrictMode`는 Next.js 앱이 포함하고 있는 리액트에서 StrictMode를 설정하는 옵션입니다.
- StrictMode 옵션을 켜면(true) 리액트 앱의 잠재적인 문제를 찾기 위해 컴포넌트를 두 번 렌더링 합니다. 이런동작은 실습에 방해를 줄 수 있기 땜누에 false로 설정하겠습니다.
- `reactStrictMode` 말고도 다양한 옵션이 존재합니다. 추후에 실습을 진행 하면서 하나하나 살펴 보겠습니다.

### tsconfig.json, next-env.d.ts
- 타입스크립트의 설정 파일
- tsconfig.json: 타입스크립트 컴파일러의 옵션 설정 파일입니다.
```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx"],
  "exclude": ["node_modules"]
}
```
- next-env.d.ts는 Next.js의 내장 타입(API 핸들러, 페이지 컴포넌트 등)을 사용할 수 있도록 설정하는 파일입니다.

### public 폴더
- 프로젝트에서 사용하는 정적 파일(이미지, 폰트, 동영상 등)을 보관하는 폴더입니다.

### src 폴더
- Next.js 앱의 소스코드를 보관하는 공간. 리액트의 컴포넌트나 함수가 작성되어 있는 자바스크립트 파일, 스타일 코드가 작성되어 있는 CSS 파일들을 이 폴더에 보관합니다.
- src 폴더는 필수 구성 요소가 아닙니다. 따라서 자바스크립트 파일을 그냥 프로젝트 루트에 보관해도 아무런 문제는 없지만, 대체로 파일을 좀 더 체계적(계층적)으로 관리하기 위해 src 폴더를 사용하빈다.
- pages폴더: 페이지 라우팅을 관리하는 폴더 입니다. pages 폴더 구조에 따라 Next.js 앱이 라우팅이 자동으로 설정됩니다.
- styles 폴더: 프로젝트 스타일을 위한 CSS 또는 Sass(Scss) 파일을 저장하는 폴더 입니다.

### ESLint 옵션 파일
- ESLint는 코드의 품질을 유지하고 코드에 존재하는 잠재 오류를 미리 발견하도록 도와주는 도구입니다. 오늘날 자바스크립트, 타입스크립트 기반 앱을 개발하는 데 필수 도구가 되었습니다.
- Next.js 앱을 생성하면 `eslint.config.mjs`라는 이름의 ESLint 설정 파일이 자동으로 생성됩니다.
```javascript
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
];

export default eslintConfig;

```
- `...compat.extends("next/core-web-vitals", "next/typescript")` : 누군가 이미 만들어 놓은 설정 규칙을 그대로 사용한다는 의미의 확장, 상속 옵션
  * `next/core-web-vitals`: Next.js의 성능을 위해 권장되는 코드 작성과 관련된 설정 규칙
  * `next/typescript`: Next.jsㅔㅇ서 타입스크립트를 안전하게 활용하기 위한 설정 규칙
- 지금 내보내는 설정 값은 Next.js 앱을 안전하게 개발하기 위해, 사용치 않는 변수나 함수도 오류로 처리하는 등 다소 엄격히 코드를 검사하는 설정입니다.
- 다음과 같이 별도의 규칙을 추가해 엄격한 일부 옵션은 헤제 합니다.
```javascript
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
    {
        rules: {
            "typescript-eslint/no-unused-vars": "off",
            "typescript-eslint/no-explicit-any": "warn",
        }
    }
];

export default eslintConfig;
```
  * `"typescript-eslint/no-unused-vars": "off"`: 실제로 사용하지 않는 변수를 오류로 판단하는 설정입니다.
  * `"typescript-eslint/no-explicit-any": "warn"`: any타입을 명시적으로 사용하지 못하도록 제한하는 옵션입니다.

## Next.js 앱 실행하기
```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  }
}
```
  
### 개발 모드로 실행하기
- `npm run dev`

### 프로덕션 모드로 실행하기
- 앱을 프로덕션 모드로 실행하려면 먼저 앱을 빌드 해야 합니다.
- `npm run build` : `.next` 폴더에 빌드의 결과물이 저장됩니다.
- `npm run start`

- 개발모드와 프로덕션 모드의 차이점
  * 개발모드: 이 모드에서는 개발자가 코드를 수정할 때마다 즉각 결과를 확인하도록 여러 디버깅 도구를 제공해 개발의 편의를 돕습니다.
    + 핫 리로딩(Hot Reloading)이 활성화되므로 코드를 수정하면 자동으로 화면을 새로고침해 변경 사항을 바로 확인할 수 있습니다.
    + 성능 보다는 개발 생산성을 우선으로 하기 때문에 코드 분석과 오류 확인이 용이하도록 상세한 로그와 경고 메시지 등을 함께 제공합니다.
  * 프로덕션 모드
    + 개발을 완료한 앱을 실제 사용자에게 배포할 때 사용합니다.
    + 개발 과정에서 필요했던 디버깅 기능은 비활성화 되는 반면, 앱의 성능 최적화 전략이 중심이 됩니다.
    + 코드를 최소화하고 불필요한 코드를 제거하는 트리 셰이킹(Tree Shaking)으로 파일의 크기를 줄이로 로드 속도를 향상시킵니다.
    + 또한 캐싱 전략을 사용해 앱이 빠르고 효율적으로 움직이도록 만듭니다.

## 라우팅 설정하기
- 웹에서 라우팅(Routing)이란 브라우저가 요청하는 URL 경로에 따라 적절한 페이지를 화면에 렌더링하기 까지의 과정을 말합니다.

### 불필요한 기본 CSS 제거하기
- `src/styles/global.css` 파일의 내용을 모두 삭제합니다.
- `src/pages/index.tsx` 내용을 다음과 같이 수정
```tsx
export default function Home() {
  return (
    <div>
      <h1>안녕 Next.js</h1>
    </div>
  );
}
```

### 파일 시스템 기반 페이지 라우팅
- 페이지 라우터 버전의 Next.js 앱에서는 `src/pages`의 폴더 구조에 따라 라우팅이 자동으로 설정됩니다.
- pages 폴더에 있는 파일 명과 폴더 구조가 그대로 URL 경로로 매핑됩니다.
  * `pages/index.tsx` -> 인덱스 페이지(/)로 자동 매핑 됩니다.
  * `pages/search.tsx` -> 검색 페이지(/search)로 자동 매핑 됩니다.
  * `pages/book/index.tsx` -> 도서 상세 페이지(/book)로 자동 매핑 됩니다.

#### 검색 페이지의 라우팅 설정하기
- 경로가 `/search`인 페이지를 추가합니다.
```tsx
// search.tsx
export default function Page() {
    return (
        <div>
            <h1>검색 페이지입니다.</h1>
        </div>
    );
}
```
- 페이지 역할을 하는 컴포넌트를 Next.js에서는 페이지 컴포넌트라고 합니다.
- 페이지 컴포넌트는 파일에서 반드시 export default 방식(기본값으로 내보내기)으로 내보내야 합니다.
- 페이지마다 페이지 컴포넌트는 반드시 하나만 있어야 합니다.
- `search.tsx` -> `/search/index.tsx` 변경 두 방식 간에는 차이가 크게 없으므로 원하는 방식을 자유롭게 선택

#### _app.tsx와 _document.tsx의 역할
- Next.js 앱에서 두 파일은 글로벌 설정을 담당하는 파일로서 페이지들에 공통으로 적용할 사항을 설정할 때 사용하는 중요한 파일입니다.

##### `_document.tsx`
- 좀 더 구체적으로 살펴보면 먼저 `_document.tsx`는 모든 페이지에 적용할 HTML 문서의 기본 틀을 설정하는 파일입니다.
```typescript jsx
import { Html, Head, Main, NextScript } from "next/document";

export default function Document() {
    return (
        <Html lang="en">
            <Head />
            <body>
                <Main />
                <NextScript />
            </body>
        </Html>
    );
}
```
- Main은 현재 페이지 컴포넌트가 렌더링될 위치를 보여 줍니다. 예를 들어 사용자가 인덱스 페이지에 접속했다면 이 위치에는 인덱스 페이지 컴포넌트가 렌더링 됩니다.
- NextScript 컴포넌트는 Next.js 앱에서 생선된 스크립트 파일들을 자동으로 HTML에 삽입해 줍니다. 브라우저가 앱을 실행하는 데 필요한 자바스크립트 코드를 페이지와 연결하는 중요한 역할을 담당합니다.
- 이 파일은 Next.js 앱에서 HTML의 기본 틀 역할을 하기 때문에 주로 `<html>`이나 `<body>` 태그에 속성을 추가하거나 `<head>` 태그에서 새로운 `<meta>` 태그를 추가할 때 사용합니다.

##### `_app.tsx`

